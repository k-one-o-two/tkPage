<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/k102.svg" type="image/svg+xml"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/a5374ac5e962e488.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a5374ac5e962e488.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-ac344eb87244516d.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c6d622a5494721a0.js" defer=""></script><script src="/_next/static/chunks/744-7465ddcb380cce9a.js" defer=""></script><script src="/_next/static/chunks/pages/mapping-37858dce81bbc970.js" defer=""></script><script src="/_next/static/U8hUdMbKAZBedyCsJXv9N/_buildManifest.js" defer=""></script><script src="/_next/static/U8hUdMbKAZBedyCsJXv9N/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="surface-50 p-3 flex justify-content-center flex-wrap"><button aria-label="About" class="p-button p-component mx-2 p-button-outlined"><span class="p-button-icon p-c p-button-icon-left pi pi-user"></span><span class="p-button-label p-c">About</span></button><button aria-label="Photos" class="p-button p-component mx-2 p-button-outlined"><span class="p-button-icon p-c p-button-icon-left pi pi-camera"></span><span class="p-button-label p-c">Photos</span></button></div><div class="pt-2 surface-200"><div class="p-card p-component"><div class="p-card-body"><div class="p-card-title">Own rides map</div><div class="p-card-content"><div><h3>Why</h3><p>So, I have realized that I <i>need</i> to draw a map of my rides, and do it myself. Yeah, I know that there are a lot of tools out there, but this is not fun. I mean, doing what others have already done way better, suffering meanwhile is fun, right?</p><h3>How</h3><p>I use Strava, so I have decided to check how can it help me. You can actually export all your data from it. To do so, go to your account settings, you are looking for &quot;Delete&quot; section.</p><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/delete.png"/></span></div><p>After pressing the &quot;Get started&quot; button, you will be able to &quot;Request Your Archive&quot; on the next page. You will get a zip archive soon after requesting it.</p><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/gpxs.png"/></span></div><p>Great, right?</p><h4>No.</h4><p>The thing is, I use Suunto 5 watches to record my activities. It&#x27;s good, but its output is not a gpx, but a fit file, even an archived one. So, along with some gpx files (I used Garmin Edge before), I have received a bunch if &quot;fit.gz&quot; ones</p><p>First, I thought to try to use them as they are, but have failed to find a tool to batch convert them into the format I understand. Not that I was looking too hard, but still, It seemed not to be straightforward.</p><h4>Let&#x27;s get them from Strava then!</h4><p>For every Strava activity you may get a gpx file, that&#x27;s pretty simple</p><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/export.png"/></span></div><p>Shortly, I&#x27;ve realized that I have to press this damn button quite a lot (yeah, I didn&#x27;t bother to count) of times. So, let&#x27;s automate! It was supposed to be fun, right?</p><h4>A bit of code</h4><p>So, I have downloaded one gpx and recorder my request using Fiddler. This gave me useful headers, that I could use to get other files. Actually, you only need to send the Cooke one. After a couple of minutes I came up with the following:</p><pre><code>
fs = require(&#x27;fs&#x27;);

const save = async (activity) =&gt; {
const myHeaders = new Headers();
myHeaders.append(
    &#x27;Cookie&#x27;,
    &#x27;Cookie:
    sp=8e_strava_cbv2=true;..ff&#x27;,
);

const res = await fetch(
    `https://www.strava.com/
    activities/
    ${activity}/
    export_gpx`,
    { headers: myHeaders },
);
</code></pre><p>The only thing - where do I get those ids? Luckily, there is an &quot;activities&quot; file in the export I&#x27;ve done before. So it was not completely useless, yay!</p><p>So just put them into an array and call like that</p><pre><code>
names.forEach((name) =&gt; save(name));
            </code></pre><p>Surprisingly, there seems to be no limit on such requests, so after a short while, I&#x27;ve got all my desired files.</p><h4>Now what?</h4><p>QGIS. This is a powerful software, so I&#x27;m a bit ashamed to use it for such a small task, using like 10% of what it is capable of. But after all, I&#x27;m already using Lightroom to move a couple of sliders, so why not.</p><p>Gpx can be imported by using &quot;Layer &gt; Add Layer &gt; Add vector layer&quot; menu.</p><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/qgis1.png"/></span></div><p>The only thing I actually needed was a line. After adding them all, don&#x27;t repeat my mistake and group them together, otherwise you&#x27;ll keep copying a style from one line to the whole group, QGIS will consume all the RAM it could find.</p><h4>Adding tiles</h4><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/qgis2.png"/></span></div>I had to add some XYZ tiles.<p>XYZ means that those tiles are obtained from a tile server by X and Y coordinates and a zoom level. You can add some manually, but it will require some manual work, which is no fun (which is still a goal of the whole thing). I have managed to find a script that will add some well-known tiles to QGIS:<br/><a href="https://raw.githubusercontent.com/klakar/QGIS_resources/master/collections/Geosupportsystem/python/qgis_basemaps.py">qgis_basemaps.py</a><br/>There is a Python console (Plugins &gt; Python Console). After running this script I&#x27;ve got a nice list of differently styled tiles.</p><h3>Non-flat Earth</h3><p>So far so good, but the map is flat, while I&#x27;d like to show that I sometimes suffer riding uphill. There are several ways to add elevation data to the map, but the easiest is to use a thing called &quot;hillshade&quot;. This is pretty much self explanatory - this is a raster image of shades, produced by hills.</p><p>After quite extensive googling (while I use duckduckgo, so... ducking?), I came across this resource<br/><a href="https://asiointi.maanmittauslaitos.fi/karttapaikka/?lang=en">asiointi.maanmittauslaitos.fi</a><br/>It allows to download quite a lot of stuff, the needed hillshade among them:</p><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/hillshade.png"/></span></div><p>After &quot;ordering&quot; it, I have received a message from &quot;no-reply@maanmittauslaitos.fi&quot; with a download link. I&#x27;ve got some .tif files. Not knowing what am I supposed to do with them, I;ve just drag&#x27;n&#x27;dropped them in QGIS. Aaand it just worked, that simple.</p><h3>Styling</h3><p>To actually show the hillshade, I have put a map (OSM) on top of it, and made it&#x27;s semi-transparent</p><p>Now, combining all that I&#x27;ve done before, I have managed to display a non-flat map with my track on it, this is how it looks like</p><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/hill.png"/></span></div><p>Well, in reality this hill looks a bit more impressive:</p><div style="position:relative;display:block;box-shadow:0px 4px 4px rgba(0, 0, 0, 0.25);text-align:center;overflow:hidden"><span class="p-image p-component"><img src="/1/view.jpg"/></span></div><h3>Done</h3><p>So, that&#x27;s it. I had some specific fun doing this and learned something new.</p></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/mapping","query":{},"buildId":"U8hUdMbKAZBedyCsJXv9N","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>